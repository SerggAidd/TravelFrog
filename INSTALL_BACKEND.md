# üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ Backend

## –ü—Ä–æ–±–ª–µ–º–∞

Backend —Ñ–∞–π–ª—ã –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –≤ `dist/` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –Ω–æ backend —Å–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ production. –ù—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫.

## –†–µ—à–µ–Ω–∏–µ: –û–¥–∏–Ω —Ä–∞–∑ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å watcher

–ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –¥–µ–ø–ª–æ—è –Ω—É–∂–Ω–æ **–æ–¥–∏–Ω —Ä–∞–∑** –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
cd /usr/share/nginx/html/apps/TravelFrog/main
chmod +x scripts/install-backend-watcher.sh
./scripts/install-backend-watcher.sh
```

**–ï—Å–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É** - –ø–æ–ø—Ä–æ—Å–∏—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —ç—Ç—É –∫–æ–º–∞–Ω–¥—É –æ–¥–∏–Ω —Ä–∞–∑.

## –ß—Ç–æ –¥–µ–ª–∞–µ—Ç install-backend-watcher.sh

1. ‚úÖ –°–æ–∑–¥–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ `check-and-start-backend.sh`
2. ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç systemd timer, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã:
   - –ï—Å—Ç—å –ª–∏ —Ñ–∞–π–ª—ã backend –≤ `main/`
   - –ó–∞–ø—É—â–µ–Ω –ª–∏ backend —Å–µ—Ä–≤–µ—Ä
3. ‚úÖ –ï—Å–ª–∏ —Ñ–∞–π–ª—ã –µ—Å—Ç—å, –Ω–æ backend –Ω–µ –∑–∞–ø—É—â–µ–Ω - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç `setup-backend.sh`
4. ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ä–∞–∑—É (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ —Ñ–∞–π–ª—ã —É–∂–µ –∑–∞–¥–µ–ø–ª–æ–µ–Ω—ã)

## –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ watcher:
- ‚úÖ Timer –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã –Ω–∞–ª–∏—á–∏–µ backend
- ‚úÖ –ü—Ä–∏ –∫–∞–∂–¥–æ–º –¥–µ–ø–ª–æ–µ —Ñ–∞–π–ª—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è
- ‚úÖ Timer –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç, —á—Ç–æ backend –Ω–µ –∑–∞–ø—É—â–µ–Ω
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç `setup-backend.sh`
- ‚úÖ Backend –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

## –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```bash
# –°—Ç–∞—Ç—É—Å timer
sudo systemctl status travelfrog-backend-check.timer

# –õ–æ–≥–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏
sudo journalctl -u travelfrog-backend-check.service -f

# –°—Ç–∞—Ç—É—Å backend
sudo systemctl status travelfrog-api.service
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx (–æ–¥–∏–Ω —Ä–∞–∑)

–ü–æ–ø—Ä–æ—Å–∏—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–æ–±–∞–≤–∏—Ç—å:

```nginx
location /api/ {
    proxy_pass http://localhost:3000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_connect_timeout 60s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;
}
```

## –ò—Ç–æ–≥–æ

1. ‚úÖ Backend —Ñ–∞–π–ª—ã –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ `dist/` –ø—Ä–∏ —Å–±–æ—Ä–∫–µ
2. ‚úÖ Jenkins –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä
3. ‚úÖ **–û–¥–∏–Ω —Ä–∞–∑** –∑–∞–ø—É—Å—Ç–∏—Ç—å `install-backend-watcher.sh` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
4. ‚úÖ –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ backend –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –¥–µ–ø–ª–æ–µ

**–ù–µ –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å Jenkins pipeline!**

