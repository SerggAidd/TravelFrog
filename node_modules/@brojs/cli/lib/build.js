import webpack from 'webpack';
import webpackConfig  from  '@brojs/webpack-config';
import { getModuleData } from   '@brojs/utils';
import chalk from 'chalk';

export const build = async ({ prod }) => {
  process.env.NODE_ENV = prod ? 'production' : 'development';
  const moduleData = await getModuleData();
  process.env.ENTRY = moduleData.entryPoint;
  
  console.log(chalk.cyan('üèóÔ∏è '), chalk.blue(`–ó–∞–ø—É—Å–∫ —Å–±–æ—Ä–∫–∏ –≤ —Ä–µ–∂–∏–º–µ ${prod ? chalk.green.bold('production') : chalk.yellow.bold('development')}...`));
  
  webpack(await webpackConfig(), (err, stats) => {
      if (err) {
        console.log(chalk.red.bold('‚ùå –û—à–∏–±–∫–∞ —Å–±–æ—Ä–∫–∏:'), err);
        throw err;
      }

      console.log(chalk.green.bold('‚úÖ –°–±–æ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!'));
      console.log(stats.toString({
        chunks: false,  // Makes the build much quieter
        colors: true    // Shows colors in the console
      }));
  });
}
